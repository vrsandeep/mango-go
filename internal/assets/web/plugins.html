<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download with Plugins - Mango</title>
    <link rel="stylesheet" href="https://unpkg.com/phosphor-icons@1.4.2/src/css/icons.css">
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/plugin.css">
</head>

<body>
    <header class="main-header">
        <div class="header-left">
            <button class="menu-toggle" id="menu-toggle-btn"><i class="ph-bold ph-list"></i></button>
            <nav class="nav-links" id="nav-links">
                <div class="sidebar-logo">
                    <!-- <svg class="header-logo" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM4 4h16v11.17l-3.17-3.17-2 2-3-3-3.17 3.17L4 12.34V4z"/></svg> -->
                    <img src="/static/images/logo.svg" alt="Mango Logo" class="header-logo">
                </div>
                <a href="/">Home</a>
                <a href="/library">Library</a>
                <a href="/admin" class="admin-only" style="display: none;">Admin</a>
                <a href="/tags">Tags</a>
                <div class="header-dropdown">
                    <button class="header-dropdown-btn" tabindex="0">Download <i class="ph-bold ph-caret-down"></i></button>
                    <div class="header-dropdown-content">
                        <a href="/downloads/plugins">Plugins</a>
                        <hr>
                        <a href="/downloads/manager">Download Manager</a>
                        <a href="/downloads/subscriptions">Subscription Manager</a>
                        </div>
                </div>
            </nav>
        </div>
        <div class="header-right">
            <button id="theme-toggle-btn"><i class="ph-bold ph-sun"></i></button>
            <button id="logout-btn" class="auth-only" style="display: none;">Logout</button>
        </div>
    </header>
    <main class="spa-container">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="search-area">
                <div class="search-input-group">
                    <i class="ph-bold ph-magnifying-glass search-icon"></i>
                    <input type="search" id="search-input" placeholder="Search for a manga...">
                    <button id="clear-search-btn" class="clear-btn" style="display: none;">
                        <i class="ph-bold ph-x"></i>
                    </button>
                </div>
                <select id="provider-select" class="provider-select">
                    <option value="">Select Provider</option>
                </select>
            </div>
            <div class="quick-actions">
                <button class="action-btn" id="filters-btn">
                    <i class="ph-bold ph-funnel"></i>
                    <span>Filters</span>
                    <span class="badge" id="filter-badge" style="display: none;">0</span>
                </button>
                <button class="action-btn" id="settings-btn">
                    <i class="ph-bold ph-gear"></i>
                    <span>Settings</span>
                </button>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Search Results Section -->
            <div class="results-section" id="results-section">
                <div class="section-header">
                    <h2>Search Results</h2>
                    <div class="results-summary" id="search-summary" style="display: none;">
                        <span id="search-count"></span> chapters found
                        <button id="search-toggle-btn" class="toggle-btn">
                            <i class="ph-bold ph-caret-down" id="search-toggle-icon"></i>
                        </button>
                    </div>
                </div>
                <div class="search-results-grid" id="search-results-grid"></div>
            </div>

            <!-- Chapters Section -->
            <div class="chapters-section" id="chapters-section" style="display: none;">
                <div class="chapters-header">
                    <div class="series-info">
                        <h2 id="chapter-series-title"></h2>
                        <div class="series-meta">
                            <span id="chapter-count"></span>
                            <span class="provider-badge" id="provider-badge"></span>
                        </div>
                    </div>
                    <div class="chapter-actions">
                        <button id="select-all-btn" class="btn-secondary">
                            <i class="ph-bold ph-check-square"></i>
                            Select All
                        </button>
                        <button id="clear-selections-btn" class="btn-secondary">
                            <i class="ph-bold ph-square"></i>
                            Clear
                        </button>
                        <button id="download-selected-btn" class="btn-primary" disabled>
                            <i class="ph-bold ph-download"></i>
                            Download Selected
                            <span class="selection-count" id="selection-count">0</span>
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <table class="chapter-table" id="chapter-table">
                        <thead>
                            <tr>
                                <th data-sort="title">
                                    <span>Title</span>
                                    <i class="ph-bold ph-sort-ascending sort-icon"></i>
                                </th>
                                <th data-sort="pages">
                                    <span>Pages</span>
                                    <i class="ph-bold ph-sort-ascending sort-icon"></i>
                                </th>
                                <th data-sort="volume">
                                    <span>Volume</span>
                                    <i class="ph-bold ph-sort-ascending sort-icon"></i>
                                </th>
                                <th data-sort="chapter">
                                    <span>Chapter</span>
                                    <i class="ph-bold ph-sort-ascending sort-icon"></i>
                                </th>
                                <th data-sort="language">
                                    <span>Language</span>
                                    <i class="ph-bold ph-sort-ascending sort-icon"></i>
                                </th>
                                <th data-sort="published_at">
                                    <span>Published</span>
                                    <i class="ph-bold ph-sort-ascending sort-icon"></i>
                                </th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Floating Panels -->
        <div class="floating-panel" id="filters-panel">
            <div class="panel-header">
                <h3>Filters</h3>
                <button class="panel-close" id="filters-close">
                    <i class="ph-bold ph-x"></i>
                </button>
            </div>
            <div class="panel-content">
                <div class="filter-group">
                    <label for="filter-title">Title</label>
                    <input type="text" id="filter-title" data-filter="title" placeholder="Filter by title...">
                </div>
                <div class="filter-group">
                    <label for="filter-language">Language</label>
                    <select id="filter-language" data-filter="language">
                        <option value="">All Languages</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filter-volume-min">Volume Range</label>
                    <div class="range-inputs">
                        <input type="number" id="filter-volume-min" data-filter="volume-min" placeholder="Min">
                        <span>to</span>
                        <input type="number" id="filter-volume-max" data-filter="volume-max" placeholder="Max">
                    </div>
                </div>
                <div class="filter-group">
                    <label for="filter-chapter-min">Chapter Range</label>
                    <div class="range-inputs">
                        <input type="number" id="filter-chapter-min" data-filter="chapter-min" placeholder="Min">
                        <span>to</span>
                        <input type="number" id="filter-chapter-max" data-filter="chapter-max" placeholder="Max">
                    </div>
                </div>
            </div>
            <div class="panel-footer">
                <button id="apply-filters-btn" class="btn-primary">Apply Filters</button>
                <button id="clear-filters-btn" class="btn-secondary">Clear All</button>
            </div>
        </div>

        <div class="floating-panel" id="settings-panel">
            <div class="panel-header">
                <h3>Download Settings</h3>
                <button class="panel-close" id="settings-close">
                    <i class="ph-bold ph-x"></i>
                </button>
            </div>
            <div class="panel-content">
                <div class="settings-group">
                    <h4>Folder Path</h4>
                    <div class="folder-selection-group">
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="folder-path" value="default" checked>
                                <span>Default (series name)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="folder-path" value="custom">
                                <span>Custom path</span>
                            </label>
                        </div>
                        <input type="text" id="custom-folder-path" placeholder="e.g., My Manga/One Piece" style="display: none;">
                        <div class="path-preview" id="path-preview" style="display: none;">
                            <small>Preview: <span id="preview-text"></span></small>
                        </div>
                    </div>
                </div>
                <div class="settings-group">
                    <h4>Subscription</h4>
                    <button id="subscribe-btn" class="btn-primary">
                        <i class="ph-bold ph-plus"></i>
                        Subscribe to Series
                    </button>
                </div>
            </div>
        </div>

        <!-- Overlay for floating panels -->
        <div class="panel-overlay" id="panel-overlay"></div>
    </main>

    <!-- Help Panel (hidden by default) -->
    <div id="help-panel" class="floating-panel">
        <div class="panel-header">
            <h3>Keyboard Shortcuts</h3>
            <button class="panel-close" id="help-close">&times;</button>
        </div>
        <div class="panel-content">
            <div class="shortcuts-list">
                <div class="shortcut-group">
                    <h4>Navigation</h4>
                    <div class="shortcut-item">
                        <kbd>/</kbd> Focus search
                    </div>
                    <div class="shortcut-item">
                        <kbd>Esc</kbd> Clear search or close panels
                    </div>
                </div>
                <div class="shortcut-group">
                    <h4>Panels</h4>
                    <div class="shortcut-item">
                        <kbd>F</kbd> Open filters
                    </div>
                    <div class="shortcut-item">
                        <kbd>S</kbd> Open settings
                    </div>
                </div>
                <div class="shortcut-group">
                    <h4>Selection</h4>
                    <div class="shortcut-item">
                        <kbd>Ctrl+A</kbd> Select all chapters
                    </div>
                    <div class="shortcut-item">
                        <kbd>Ctrl+D</kbd> Deselect all chapters
                    </div>
                </div>
                <div class="shortcut-group">
                    <h4>Actions</h4>
                    <div class="shortcut-item">
                        <kbd>Ctrl+Enter</kbd> Download selected chapters
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="main-footer">
        <span id="version-footer"></span>
    </footer>
    <script src="/static/js/header.js"></script>
    <script src="/static/js/toast.js"></script>
    <script src="/static/js/path-utils.js"></script>
    <script src="/static/js/plugins.js"></script>
</body>

</html>